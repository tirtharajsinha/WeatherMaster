<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Primary Meta Tags -->


    <title>{{Title}} | WeatherMaster</title>

    {{#if ishome}}
    <meta name="title" content="WeatherMaster">
    <meta name="description" content="A web-based graphical weather application.">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://WeatherMaster.github.io">
    <meta property="og:title" content="WeatherMaster">
    <meta property="og:description" content="A web-based graphical weather application.">
    <meta property="og:image" content="/meta/screen_desktop2.png">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://WeatherMaster.github.io">
    <meta property="twitter:title" content="WeatherMaster">
    <meta property="twitter:description" content="A web-based graphical weather application.">
    <meta property="twitter:image" content="/meta/screen_desktop2.png">



    {{else}}
    <meta name="title" content="View today's weather at {{data.name}} | WeatherMaster">
    <meta name="description" content="A web-based graphical weather application.">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://WeatherMaster.github.io">
    <meta property="og:title" content="View today's weather at {{data.name}} | WeatherMaster">
    <meta property="og:description" content="A web-based graphical weather application.">
    <meta property="og:image" content="/meta/screen_desktop2.png">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://WeatherMaster.github.io">
    <meta property="twitter:title" content="View today's weather at {{data.name}} | WeatherMaster">
    <meta property="twitter:description" content="A web-based graphical weather application.">
    <meta property="twitter:image" content="/meta/screen_desktop2.png">
    {{/if}}








    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="stylesheet" href="/weather-icons.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@splidejs/splide@4.1.4/dist/css/splide.min.css">
    <script src="https://code.jquery.com/jquery-3.6.4.js"
        integrity="sha256-a9jBBRygX1Bh5lt8GZjXDzyOB+bWve9EiO7tROUtj/E=" crossorigin="anonymous"></script>
    <style>
        .container {
            width: 100%;
            min-height: 100vh;
            display: grid;
            grid-template-columns: 0.4fr 1.6fr;
            background: url(/bg/{{data.bg}}.jpg);
            background-position: center;
            background-repeat: no-repeat;
            background-size: cover;
            color: var(--primary-color);
        }
    </style>
    <link rel="stylesheet" href="/style.css">
    <link rel="stylesheet" href="/css/loader.css">
</head>

<body>
    <div class="container">
        <div class="current">
            <div class="search-city">
                <i class="fal fa-thermometer-three-quarters"></i>
                <input type="text" placeholder="Kolkata, IN" id="search" autocomplete="off">
                <i class="fal fa-search"></i>
            </div>
            <div class="searchresult">
            </div>

            <div class="curweatherdata">
                <div class="cityname">{{data.name}}, {{data.country}} <i class="fal fa-map-marker-alt"></i></div>
                <div class="wdata">
                    <div class="cur-temp">
                        <span class="temp">{{data.temp}}°</span>
                        <span>~ 3</span>
                    </div>
                    <div class="other-data">
                        <span class="hum"></span>
                        <span class="wind"><i class="fal fa-wind"></i> Wind : {{data.wind}} kmph</span>
                    </div>
                </div>
                <div class="cweatherDes">
                    {{{data.des}}}
                </div>
                <div class="cloc">
                    <i class="wi {{data.icon}}"></i>
                    {{data.country}}, Friday, Feb 21, 2023, 12:44AM
                </div>
                <div class="cloud">
                    <div class="visual">
                        <div></div>
                        <div></div>
                        <div></div>
                        <div></div>
                        <div></div>
                        <div></div>
                    </div>
                    <div class="cloudp">
                        <span>{{data.cloud}}%</span>
                        <span>Cloud</span>
                    </div>
                </div>
                <div class="more-details">
                    <div class="maxtemp"><i class="fal fa-temperature-up"></i> Max temperature : {{data.tmax}}°</div>
                    <div class="mintemp"><i class="fal fa-temperature-down"></i> Min temperature : {{data.tmin}}°</div>
                    <div class="pressure"><i class="fal fa-tint"></i> Humidity : {{data.hum}}%</div>
                </div>
            </div>
        </div>
        <div class="forcust">
            <div class="branding">
                WEATHER<br>MASTER
            </div>
            <div class="wforcast">
                <span>Weather Forcast</span>
            </div>
            <div class="weatherDes">
                {{{data.des}}}
            </div>
            <div class="loc">
                <i class="wi {{data.icon}}"></i>
                {{data.fullcountry}}, {{datetime}}
            </div>


            <div class="fordata">
                <section class="splide" id="splide1" aria-label="Splide Basic HTML Example">
                    <div class="splide__track">
                        <ul class="splide__list">
                            {{#each forcast}}
                            <li class="splide__slide">
                                <span class="time">{{this.time}}</span>
                                <i class="wi {{this.icon}}"></i>
                                <span class="fortemp">{{this.temp}}°C</span>
                            </li>
                            {{/each}}

                        </ul>
                    </div>
                </section>
            </div>
            <svg xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink"
                xmlns:svgjs="http://svgjs.dev/svgjs" viewBox="0 0 800 150">
                <defs>
                    <linearGradient gradientTransform="rotate(270)" x1="50%" y1="0%" x2="50%" y2="100%"
                        id="sssquiggly-grad">
                        <stop stop-color="hsl(50, 98%, 60%)" stop-opacity="1" offset="0%"></stop>
                        <stop stop-color="hsla(23, 100%, 50%, 1.00)" stop-opacity="1" offset="100%"></stop>
                    </linearGradient>
                </defs>
                <g stroke-width="2.5" stroke="url(#sssquiggly-grad)" fill="none" stroke-linecap="round"
                    transform="matrix(1,0,0,1,-5,-395.48522567749023)">
                    <path
                        d="M10,10C21.805555555555557,13.958333333333332,40.97222222222223,36.5,66.66666666666667,29C92.36111111111111,21.5,105.55555555555557,-32.25,133.33333333333334,-26C161.11111111111111,-19.75,172.22222222222223,60.458333333333336,200,59C227.77777777777777,57.541666666666664,238.8888888888889,-30.916666666666668,266.6666666666667,-33C294.44444444444446,-35.083333333333336,305.5555555555556,41.916666666666664,333.33333333333337,49C361.11111111111114,56.083333333333336,372.22222222222223,1,400,1C427.77777777777777,1,438.8888888888889,49.416666666666664,466.6666666666667,49C494.44444444444446,48.583333333333336,505.5555555555556,-5.375,533.3333333333334,-1C561.1111111111111,3.375,572.2222222222222,71.04166666666667,600,70C627.7777777777778,68.95833333333333,638.8888888888889,-0.7916666666666661,666.6666666666667,-6C694.4444444444446,-11.208333333333334,705.5555555555557,47.291666666666664,733.3333333333334,45C761.1111111111111,42.708333333333336,786.1111111111111,-4.083333333333332,800,-17"
                        transform="matrix(1,0,0,1,0,444)"></path>

                </g>
            </svg>

            <div class="othercitydata">
                <section class="splide" id="splide2" aria-label="Splide Basic HTML Example">
                    <div class="splide__track">
                        <ul class="splide__list">
                            <li class="splide__slide">
                                <div class="othercity">
                                    <span>10°</span>
                                    <span>London</span>
                                </div>
                            </li>
                            <li class="splide__slide">
                                <div class="othercity">
                                    <span>10°</span>
                                    <span>London</span>
                                </div>
                            </li>
                            <li class="splide__slide">
                                <div class="othercity">
                                    <span>10°</span>
                                    <span>London</span>
                                </div>
                            </li>
                            <li class="splide__slide">
                                <div class="othercity">
                                    <span>10°</span>
                                    <span>London</span>
                                </div>
                            </li>
                            <li class="splide__slide">
                                <div class="othercity">
                                    <span>10°</span>
                                    <span>London</span>
                                </div>
                            </li>
                            <li class="splide__slide">
                                <div class="othercity">
                                    <span>10°</span>
                                    <span>London</span>
                                </div>
                            </li>
                        </ul>
                    </div>
                </section>
            </div>


        </div>
    </div>
    <div id="loader">
        <div class="preloader" style="opacity: 1; ">
            <svg version="1.1" id="sun" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
                x="0px" y="0px" width="10px" height="10px" viewBox="0 0 10 10" enable-background="new 0 0 10 10"
                xml:space="preserve" style="opacity: 1; margin-left: 0px; margin-top: 0px;">
                <g>
                    <path fill="none"
                        d="M6.942,3.876c-0.4-0.692-1.146-1.123-1.946-1.123c-0.392,0-0.779,0.104-1.121,0.301c-1.072,0.619-1.44,1.994-0.821,3.067C3.454,6.815,4.2,7.245,5,7.245c0.392,0,0.779-0.104,1.121-0.301C6.64,6.644,7.013,6.159,7.167,5.581C7.321,5,7.243,4.396,6.942,3.876z M6.88,5.505C6.745,6.007,6.423,6.427,5.973,6.688C5.676,6.858,5.34,6.948,5,6.948c-0.695,0-1.343-0.373-1.69-0.975C2.774,5.043,3.093,3.849,4.024,3.312C4.32,3.14,4.656,3.05,4.996,3.05c0.695,0,1.342,0.374,1.69,0.975C6.946,4.476,7.015,5,6.88,5.505z">
                    </path>
                    <path fill="none"
                        d="M8.759,2.828C8.718,2.757,8.626,2.732,8.556,2.774L7.345,3.473c-0.07,0.041-0.094,0.132-0.053,0.202C7.319,3.723,7.368,3.75,7.419,3.75c0.025,0,0.053-0.007,0.074-0.02l1.211-0.699C8.774,2.989,8.8,2.899,8.759,2.828z">
                    </path>
                    <path fill="none"
                        d="M1.238,7.171c0.027,0.047,0.077,0.074,0.128,0.074c0.025,0,0.051-0.008,0.074-0.02l1.211-0.699c0.071-0.041,0.095-0.133,0.054-0.203S2.574,6.228,2.503,6.269l-1.21,0.699C1.221,7.009,1.197,7.101,1.238,7.171z">
                    </path>
                    <path fill="none"
                        d="M6.396,2.726c0.052,0,0.102-0.026,0.13-0.075l0.349-0.605C6.915,1.976,6.89,1.885,6.819,1.844c-0.07-0.042-0.162-0.017-0.202,0.054L6.269,2.503C6.228,2.574,6.251,2.666,6.322,2.706C6.346,2.719,6.371,2.726,6.396,2.726z">
                    </path>
                    <path fill="none"
                        d="M3.472,7.347L3.123,7.952c-0.041,0.07-0.017,0.162,0.054,0.203C3.2,8.169,3.226,8.175,3.25,8.175c0.052,0,0.102-0.027,0.129-0.074l0.349-0.605c0.041-0.07,0.017-0.16-0.054-0.203C3.603,7.251,3.513,7.276,3.472,7.347z">
                    </path>
                    <path fill="none"
                        d="M3.601,2.726c0.025,0,0.051-0.007,0.074-0.02C3.746,2.666,3.77,2.574,3.729,2.503l-0.35-0.604C3.338,1.828,3.248,1.804,3.177,1.844C3.106,1.886,3.082,1.976,3.123,2.047l0.35,0.604C3.5,2.7,3.549,2.726,3.601,2.726z">
                    </path>
                    <path fill="none"
                        d="M6.321,7.292c-0.07,0.043-0.094,0.133-0.054,0.203l0.351,0.605c0.026,0.047,0.076,0.074,0.127,0.074c0.025,0,0.051-0.006,0.074-0.02c0.072-0.041,0.096-0.133,0.055-0.203l-0.35-0.605C6.483,7.276,6.393,7.253,6.321,7.292z">
                    </path>
                    <path fill="none"
                        d="M2.202,5.146c0.082,0,0.149-0.065,0.149-0.147S2.284,4.851,2.202,4.851H1.503c-0.082,0-0.148,0.066-0.148,0.148s0.066,0.147,0.148,0.147H2.202z">
                    </path>
                    <path fill="none"
                        d="M8.493,4.851H7.794c-0.082,0-0.148,0.066-0.148,0.148s0.066,0.147,0.148,0.147l0,0h0.699c0.082,0,0.148-0.065,0.148-0.147S8.575,4.851,8.493,4.851L8.493,4.851z">
                    </path>
                    <path fill="none"
                        d="M5.146,2.203V0.805c0-0.082-0.066-0.148-0.148-0.148c-0.082,0-0.148,0.066-0.148,0.148v1.398c0,0.082,0.066,0.149,0.148,0.149C5.08,2.352,5.146,2.285,5.146,2.203z">
                    </path>
                    <path fill="none"
                        d="M4.85,7.796v1.396c0,0.082,0.066,0.15,0.148,0.15c0.082,0,0.148-0.068,0.148-0.15V7.796c0-0.082-0.066-0.148-0.148-0.148C4.917,7.647,4.85,7.714,4.85,7.796z">
                    </path>
                    <path fill="none"
                        d="M2.651,3.473L1.44,2.774C1.369,2.732,1.279,2.757,1.238,2.828C1.197,2.899,1.221,2.989,1.292,3.031l1.21,0.699c0.023,0.013,0.049,0.02,0.074,0.02c0.051,0,0.101-0.026,0.129-0.075C2.747,3.604,2.722,3.514,2.651,3.473z">
                    </path>
                    <path fill="none"
                        d="M8.704,6.968L7.493,6.269c-0.07-0.041-0.162-0.016-0.201,0.055c-0.041,0.07-0.018,0.162,0.053,0.203l1.211,0.699c0.023,0.012,0.049,0.02,0.074,0.02c0.051,0,0.102-0.027,0.129-0.074C8.8,7.101,8.776,7.009,8.704,6.968z">
                    </path>
                </g>
            </svg>

            <svg version="1.1" id="cloud" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
                x="0px" y="0px" width="10px" height="10px" viewBox="0 0 10 10" enable-background="new 0 0 10 10"
                xml:space="preserve">
                <path fill="none"
                    d="M8.528,5.624H8.247c-0.085,0-0.156-0.068-0.156-0.154c0-0.694-0.563-1.257-1.257-1.257c-0.098,0-0.197,0.013-0.3,0.038C6.493,4.259,6.45,4.252,6.415,4.229C6.38,4.208,6.356,4.172,6.348,4.131C6.117,3.032,5.135,2.235,4.01,2.235c-1.252,0-2.297,0.979-2.379,2.23c-0.004,0.056-0.039,0.108-0.093,0.13C1.076,4.793,0.776,5.249,0.776,5.752c0,0.693,0.564,1.257,1.257,1.257h6.495c0.383,0,0.695-0.31,0.695-0.692S8.911,5.624,8.528,5.624z">
                </path>
            </svg>

            <div class="rain">
                <span class="drop"></span>
                <span class="drop"></span>
                <span class="drop"></span>
                <span class="drop"></span>
                <span class="drop"></span>
                <span class="drop"></span>
                <span class="drop"></span>
                <span class="drop"></span>
                <span class="drop"></span>
                <span class="drop"></span>
            </div>

            <div class="text">
                LOOKING OUTSIDE FOR YOU... ONE SEC
            </div>
        </div>

    </div>
    {{#if save}}
    <div class="save" data-name="{{data.name}}" data-country="{{data.country}}" data-lat="{{data.lat}}"
        data-lon="{{data.lon}}" onclick="savetolocal(this)">Save</div>
    {{/if}}

    <script src="/fontawasome5.15-pro.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@splidejs/splide@4.1.4/dist/js/splide.min.js"></script>
    <script>

        $(document).ready(function () {
            console.log("document loaded");
        });

        $(window).on("load", function () {
            console.log("window loaded");
            document.getElementById("loader").style.display = "none";
        });

        function geticon(code) {
            var prefix = 'wi-';
            var icon = weatherIcons[code].icon;

            // If we are not in the ranges mentioned above, add a day/night prefix.
            if (!(code > 699 && code < 800) && !(code > 899 && code < 1000)) {
                icon = 'day-' + icon;
            }

            // Finally tack on the prefix.
            icon = prefix + icon;
            document.getElementById("wicon").classList.add("wi")
            document.getElementById("wicon").classList.add(icon);

        }


        var splide1 = new Splide('#splide1', {
            type: 'slide',
            drag: 'free',
            snap: true,
            perPage: 6,
            breakpoints: {
                900: {
                    perPage: 5,
                },
                800: {
                    perPage: 4,
                },
                700: {
                    perPage: 3,
                }
            },
            pagination: false,
            wheel: false,
            arrows: false
        });
        splide1.mount();

        var splide2 = new Splide('#splide2', {
            type: 'slide',
            drag: 'free',
            snap: true,
            perPage: 6,
            breakpoints: {
                900: {
                    perPage: 5,
                },
                800: {
                    perPage: 4,
                },
                700: {
                    perPage: 3,
                }
            },
            pagination: false,
            wheel: false,
            arrows: false
        });
        splide2.mount();
        document.getElementById("search").addEventListener("input", (e) => {
            if (e.target.value == "") {
                document.querySelector(".searchresult").innerHTML = "";
            }
        });
        document.getElementById("search").addEventListener("change", (e) => {
            let query = e.target.value;
            if (query == "") {
                return;
            }
            document.querySelector(".searchresult").innerHTML = `<div class="miniloader"></div>`
            fetch(`/api/${query}`)
                .then((response) => response.json())
                .then((data) => {
                    console.log(data.length);
                    let display = ""
                    if (data.length == 0) {
                        display = `<p class="worning">No place found.</p>`;
                    }
                    data.forEach(res => {
                        state = res.state + ", "
                        if (res.state == "") {
                            state = ""
                        }
                        display += `
                        <div class="sugg" 
                        data-name="${res.name}" 
                        data-country="${res.country}" 
                        data-state="${state}"
                        data-lat="${res.lat}"
                        data-lon=${res.lon}
                        onclick="findweather(this)"
                        >
                            <span>${res.name}</span>
                            <span>${state}${res.country}</span>
                        </div>
                        `
                    });
                    document.querySelector(".searchresult").innerHTML = display;
                });
        })

        function findweather(ele) {
            document.querySelector("#loader").style.display = "flex";
            let lat = ele.dataset.lat;
            let lon = ele.dataset.lon;
            let name = ele.dataset.name;
            let country = ele.dataset.country;
            let url = `/weather/${country}/${name}/${lat}/${lon}`
            window.location.href = url;
        }
        let condition = "{{data.bg}}"
        let theme;
        if (condition.startsWith("clear")) {
            theme = "light";
        }
        else if (condition.startsWith("thunder")) {
            theme = "dark"
        }
        else if (condition.startsWith("cloud")) {
            theme = "dark";
        }
        else if (condition.startsWith("snow")) {
            theme = "light"
        }
        else if (condition.startsWith("rain")) {
            theme = "dark"
        }
        if (theme == "light") {
            document.querySelector("body").classList.add("light");
        }



        function savetolocal(ele) {
            let name = ele.dataset.name;
            let country = ele.dataset.country;
            let lat = ele.dataset.lat;
            let lon = ele.dataset.lon
            fetch(`/save/${country}/${name}/${lat}/${lon}`)
                .then((response) => {
                    ele.innerHTML = "Saved";
                    ele.style.background = "lightgreen";
                })


        }





    </script>
</body>

</html>